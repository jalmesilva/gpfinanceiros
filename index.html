<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestor Financeiro</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button, select { margin: 5px; padding: 5px; }
    .card { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin-top: 15px; }
    .despesa { margin: 5px 0; }
    #loginScreen { max-width: 300px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen">
    <h2>Login</h2>
    <input id="email" type="text" placeholder="Email"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="login()">Entrar</button>
    <p id="loginError" style="color:red;display:none;">Credenciais inválidas</p>
  </div>

  <!-- App Screen -->
  <div id="app" style="display:none;">
    <h1>Gestor Financeiro</h1>
    <div>
      <input type="text" id="nomePerfil" placeholder="Nome do perfil">
      <input type="number" id="saldo" placeholder="Saldo inicial">
      <input type="number" id="dias" placeholder="Nº dias">
      <button onclick="criarPerfil()">Criar Perfil</button>
    </div>

    <div>
      <select id="listaPerfis" onchange="selecionarPerfil()"></select>
      <button onclick="eliminarPerfil()">Eliminar Perfil</button>
    </div>

    <div id="dadosPerfil" class="card" style="display:none;">
      <h3 id="tituloPerfil"></h3>
      <p><strong>Saldo:</strong> <span id="saldoAtual"></span> €</p>
      <p><strong>Dias restantes:</strong> <span id="diasRestantes"></span></p>
      <p><strong>Média diária disponível:</strong> <span id="mediaDiaria"></span> €</p>

      <h4>Adicionar Despesa</h4>
      <input type="number" id="valorDespesa" placeholder="Valor">
      <input type="text" id="obsDespesa" placeholder="Observação (opcional)">
      <button onclick="adicionarDespesa()">Adicionar</button>

      <div>
        <h4>Histórico de Despesas</h4>
        <ul id="listaDespesas"></ul>
      </div>
    </div>
  </div>

  <script>
    // --- Login simples ---
    const users = {
      "jorge@email.com": "1234",
      "esposa@email.com": "abcd"
    };

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      if (users[email] && users[email] === password) {
        sessionStorage.setItem("loggedIn", email);
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("app").style.display = "block";
        carregarPerfis();
      } else {
        document.getElementById("loginError").style.display = "block";
      }
    }

    window.onload = () => {
      if (sessionStorage.getItem("loggedIn")) {
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("app").style.display = "block";
        carregarPerfis();
      }
    };

    // --- Lógica da App ---
    let perfilAtivo = null;

    function obterPerfis() {
      return JSON.parse(localStorage.getItem("perfis") || "{}");
    }

    function guardarPerfis(perfis) {
      localStorage.setItem("perfis", JSON.stringify(perfis));
    }

    function criarPerfil() {
      const nome = document.getElementById("nomePerfil").value;
      const saldo = parseFloat(document.getElementById("saldo").value);
      const dias = parseInt(document.getElementById("dias").value);
      if (!nome || isNaN(saldo) || isNaN(dias)) return alert("Preencha todos os campos");

      const perfis = obterPerfis();
      perfis[nome] = { saldo, dias, despesas: [] };
      guardarPerfis(perfis);
      carregarPerfis();
    }

    function carregarPerfis() {
      const lista = document.getElementById("listaPerfis");
      lista.innerHTML = "";
      const perfis = obterPerfis();
      const nomes = Object.keys(perfis);

      for (const nome of nomes) {
        const opt = document.createElement("option");
        opt.value = nome;
        opt.textContent = nome;
        lista.appendChild(opt);
      }

      if (nomes.length === 1) {
        perfilAt
