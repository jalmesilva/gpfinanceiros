<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Gestor Financeiro</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    h1 { color: #333; }
    .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    input, select, button { margin: 5px 0; padding: 8px; }
    button { cursor: pointer; border: none; border-radius: 8px; padding: 8px 16px; }
    .add { background: #4caf50; color: white; }
    .delete { background: #e53935; color: white; }
    .secondary { background: #1976d2; color: white; }
    ul { padding-left: 20px; }
  </style>
</head>
<body>
  <h1>Gestor Financeiro</h1>

  <!-- Criar perfil -->
  <div class="card">
    <h2>Novo Perfil</h2>
    <input type="text" id="perfilNome" placeholder="Nome do perfil">
    <input type="number" id="perfilSaldo" placeholder="Saldo inicial (€)">
    <input type="number" id="perfilDias" placeholder="Número de dias">
    <button class="add" onclick="criarPerfil()">Criar Perfil</button>
  </div>

  <!-- Selecionar/eliminar perfil -->
  <div class="card">
    <h2>Perfis</h2>
    <select id="listaPerfis" onchange="selecionarPerfil()"></select>
    <button class="delete" onclick="eliminarPerfil()">Eliminar Perfil</button>
  </div>

  <!-- Gestão do perfil ativo -->
  <div class="card" id="perfilAtivoSecao" style="display:none;">
    <h2 id="perfilTitulo"></h2>
    <p><b>Saldo inicial:</b> <span id="saldoInicial"></span> €</p>
    <p><b>Saldo restante:</b> <span id="saldoRestante"></span> €</p>
    <p><b>Média disponível por dia:</b> <span id="mediaDiaria"></span> €</p>

    <h3>Adicionar Despesa</h3>
    <input type="date" id="despesaData">
    <input type="number" id="despesaValor" placeholder="Valor (€)">
    <input type="text" id="despesaObs" placeholder="Observação (opcional)">
    <button class="secondary" onclick="adicionarDespesa()">Adicionar</button>

    <h3>Despesas</h3>
    <ul id="listaDespesas"></ul>
  </div>

  <script>
    let perfilAtivo = null;

    function guardarPerfis(perfis) {
      localStorage.setItem("perfis", JSON.stringify(perfis));
    }

    function obterPerfis() {
      return JSON.parse(localStorage.getItem("perfis") || "{}");
    }

    function carregarPerfis() {
      const lista = document.getElementById("listaPerfis");
      lista.innerHTML = "";
      const perfis = obterPerfis();
      for (const nome in perfis) {
        const opt = document.createElement("option");
        opt.value = nome;
        opt.textContent = nome;
        lista.appendChild(opt);
      }
    }

    function criarPerfil() {
      const nome = document.getElementById("perfilNome").value.trim();
      const saldo = parseFloat(document.getElementById("perfilSaldo").value);
      const dias = parseInt(document.getElementById("perfilDias").value);
      if (!nome || isNaN(saldo) || isNaN(dias)) return alert("Preencha todos os campos.");
      
      const perfis = obterPerfis();
      perfis[nome] = { saldoInicial: saldo, dias, despesas: [] };
      guardarPerfis(perfis);
      carregarPerfis();
      document.getElementById("perfilNome").value = "";
      document.getElementById("perfilSaldo").value = "";
      document.getElementById("perfilDias").value = "";
    }

    function selecionarPerfil() {
      const lista = document.getElementById("listaPerfis");
      perfilAtivo = lista.value;
      mostrarPerfil();
    }

    function eliminarPerfil() {
      if (!perfilAtivo) return alert("Selecione um perfil primeiro.");
      if (!confirm(`Tem a certeza que deseja eliminar o perfil "${perfilAtivo}"?`)) return;
      const perfis = obterPerfis();
      delete perfis[perfilAtivo];
      guardarPerfis(perfis);
      perfilAtivo = null;
      carregarPerfis();
      document.getElementById("perfilAtivoSecao").style.display = "none";
    }

    function mostrarPerfil() {
      if (!perfilAtivo) return;
      const perfis = obterPerfis();
      const perfil = perfis[perfilAtivo];
      if (!perfil) return;

      const gasto = perfil.despesas.reduce((acc, d) => acc + d.valor, 0);
      const restante = perfil.saldoInicial - gasto;

      const diasPassados = new Set(perfil.despesas.map(d => d.data)).size;
      const diasRestantes = Math.max(perfil.dias - diasPassados, 1);
      const media = (restante / diasRestantes).toFixed(2);

      document.getElementById("perfilTitulo").textContent = "Perfil: " + perfilAtivo;
      document.getElementById("saldoInicial").textContent = perfil.saldoInicial.toFixed(2);
      document.getElementById("saldoRestante").textContent = restante.toFixed(2);
      document.getElementById("mediaDiaria").textContent = media;

      const lista = document.getElementById("listaDespesas");
      lista.innerHTML = "";
      perfil.despesas.forEach(d => {
        const li = document.createElement("li");
        li.textContent = `${d.data} - ${d.valor.toFixed(2)}€ ${d.observacao ? "(" + d.observacao + ")" : ""}`;
        lista.appendChild(li);
      });

      document.getElementById("perfilAtivoSecao").style.display = "block";
    }

    function adicionarDespesa() {
      if (!perfilAtivo) return alert("Selecione um perfil primeiro.");
      const data = document.getElementById("despesaData").value;
      const valor = parseFloat(document.getElementById("despesaValor").value);
      const obs = document.getElementById("despesaObs").value.trim();
      if (!data || isNaN(valor)) return alert("Preencha corretamente a data e valor.");
      
      const perfis = obterPerfis();
      perfis[perfilAtivo].despesas.push({ data, valor, observacao: obs });
      guardarPerfis(perfis);

      document.getElementById("despesaData").value = "";
      document.getElementById("despesaValor").value = "";
      document.getElementById("despesaObs").value = "";

      mostrarPerfil();
    }

    // inicialização
    window.onload = carregarPerfis;
  </script>
</body>
</html>
